document.addEventListener('DOMContentLoaded', function() {

  // Use buttons to toggle between views
  document.querySelector('#inbox').addEventListener('click', () => load_mailbox('inbox'));
  document.querySelector('#sent').addEventListener('click', () => load_mailbox('sent'));
  document.querySelector('#archived').addEventListener('click', () => load_mailbox('archive'));
  document.querySelector('#compose').addEventListener('click', compose_email);
  document.querySelector('#submit').addEventListener('click', send_email);

  // By default, load the inbox
  load_mailbox('inbox');
});
function send_email() {
event.preventDefault();
const recipients= document.querySelector('#compose-recipients').value;
const subject= document.querySelector('#compose-subject').value;
const body= document.querySelector('#compose-body').value;

fetch('/emails', {
  method: 'POST',
  body: JSON.stringify({
      recipients: recipients,
      subject: subject,
      body: body,
  }),
  })
    // Take the return data and parse it in JSON format.
    .then((response) => response.json())
    .then((result) => {
      load_mailbox("sent", result);
    })
    .catch((error) => console.log(error));
};

function compose_email() {

  // Show compose view and hide other views
  document.querySelector('#emails-view').style.display = 'none';
  document.querySelector('#compose-view').style.display = 'block';

  // Clear out composition fields
  document.querySelector('#compose-recipients').value = '';
  document.querySelector('#compose-subject').value = '';
  document.querySelector('#compose-body').value = '';
}


function load_mailbox(mailbox) {

  let email_view = document.querySelector('#emails-view')
  document.querySelector('#emails-view').style.display = 'none';
  document.querySelector('#compose-view').style.display = 'none';
  // Show the mailbox and hide other views
  email_view.style.display = 'block';
  document.querySelector('#compose-view').style.display = 'none';

  // Show the mailbox name
  email_view.innerHTML = '';
  email_view.innerHTML = `<h3>${mailbox.charAt(0).toUpperCase() + mailbox.slice(1)}</h3>`;
// Find a <table> element with id="myTable":
var table = document.getElementById("myTable");

// Create an empty <thead> element and add it to the table:
var header = table.createTHead();

// Create an empty <tr> element and add it to the first position of <thead>:
var row = header.insertRow(0);

// Insert a new cell (<td>) at the first position of the "new" <tr> element:
var cell = row.insertCell(0);

// Add some bold text in the new cell:
cell.innerHTML = "<b>This is a table header</b>";
  //GET request
  fetch(`/emails/${mailbox}`)
    .then(response => response.json())
    .then(emails => {

      if (emails.length == 0) {
        email_view.innerHTML = '<p style = "font-size: large; font-weight: bold;">Nothing to see here :(</p>';
      }
      else {
        for (email in emails) {

          const mail = document.createElement("div");
          const sender = document.createElement('h5');
          const rec=document.createElement('p');
          const sub = document.createElement('p');
          const time = document.createElement('p');
          //const id = document.createElement('p');


          rec.innerHTML=emails[email].recipients;

          sender.innerHTML = emails[email].sender;
          if (emails[email].subject == '') {
            sub.innerHTML = 'No Subject';
            sub.style.color = 'red';
          }
          else {
            sub.innerHTML = emails[email].subject;
          }
          time.innerHTML = emails[email].timestamp;

          mail.style.borderStyle = 'solid';
          mail.style.borderColor = 'black';
          mail.style.borderWidth = '0.1rem';
          mail.style.marginBottom = '0.2rem';
          if (emails[email].read == true) {
            mail.style.backgroundColor = 'lightgray';
          }
          else {
            mail.style.backgroundColor = 'white';
          }
          mail.classList.add('container');
          mail.classList.add('mail');

          sender.style.display = 'inline-block';
          sender.style.margin = '0.5rem';


          rec.style.display = 'inline-block';
          rec.style.margin = '1rem';
          rec.style.color='green';

          sub.style.display = 'inline-block';
          sub.style.margin = '0.5rem';


          time.style.display = 'inline-block';
          time.style.margin = '1rem';
          time.style.float = 'right';
          time.style.color = 'blue';

          email_view.appendChild(mail);
          mail.appendChild(sender);
          mail.appendChild(sub);
          mail.appendChild(time);
          //mail.appendChild(id);
          mail.appendChild(rec);

          //what happens when a user clicks on an email in the mailbox
          mail.addEventListener('click', () => load_email());
          sub.addEventListener('click', () => load_email());
          time.addEventListener('click', () => load_email());
          sender.addEventListener('click', () => load_email());
        }
      }
    }

    );





}



