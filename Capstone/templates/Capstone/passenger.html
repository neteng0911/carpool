{% extends "Capstone/layout.html" %}
{% load static %}
{% block body %}
{% load qr_code %}
{% load i18n %}




  <!-- trip start-->



<div class="container-fluid">


  <div class="row">
      <div class="col-sm-2 ">
            <div class="sticky-top" style="padding-top:50px; z-index: 0;">
            <div class="text-dark border border-dark border-3 p-2 bd-highlight mt-2 rounded-2 ">{% trans 'Total Trips' %}:<strong>{{routes_count}}</strong>
                <br>
            <a  class="text-secondary"  href="{% url 'valid_trips' %}" ><strong> {% trans 'Show Valid Trips' %} </strong></a>
            </div>
      </div>
        </div>
      <div class="col-sm-2 order-sm-last">
            <div class="sticky-top" style="padding-top:50px; z-index: 0;">
                  <form  method="POST" action="{% url 'passenger' %}">
                    {% csrf_token %}
                    <input class = 'form-control' type="search" name="searched" placeholder={% trans "Search.." %}>
                    <button class="btn btn-outline-secondary mt-1" type="Submit">{% trans 'Search'%}</button>

                  </form>
       </div>
            </div>
      <div class="col-sm  order-sm-2">

        <!--TRIP STARTS HERE-->
{% for route in  page.object_list %}

      <div class="prof ">
    <h5 class="bg-info col-md-auto mx-1 pr-5 shadow-lg"></h5>
          <div data-fin="{{route.fin}}" data-fin_set="{{route.fin_set}}" data-fin_p="{{route.fin_p}}">
        <h5> <strong><a href="{% url 'webload_route' route.id %}" > {% trans 'Trip No' %}:{{route.id}} </a></strong> </h5>
             {% if route.fin or route.fin_set  %} <h5 id='closed_{{route.id}}' style='color:red;'> {% trans 'Trip Closed'%}</h5>{% endif %}
              {% if route.fin_p %} <h5 id='closedp_{{route.id}}' style='color:red;'> {% trans 'No empty seats'%}</h5>{% endif %}
              <h5 class='closedjs_p' id = 'closedjsp_{{route.id}}' style='color:red;'> {% trans 'No empty seats'%} </h5><p id="fin_p{{route.id}}" hidden>{{route.fin_p}}</p>
          <h5 class='closedjs' id = 'closedjs_{{route.id}}' style='color:red;'> {% trans 'Trip Closed'%} </h5><p id="fin_{{route.id}}" hidden>{{route.fin}}</p>
    <h6> {% trans 'From' %}</h6> {{route.departure}}
    <h6> {% trans 'To' %}</h6> {{route.destination}}
    <h6> {% trans 'Leaving on' %} </h6> {{route.date_orig}}
    <h6> {% trans 'Leaving at' %} </h6> {{route.time_orig}}
    <h6> {% trans 'Returning on' %}</h6> {{route.date_ret}}
    <h6> {% trans 'Returning at' %} </h6> {{route.time_dep}}
    <h6> {% trans 'Distance' %} </h6> {{route.dist}}Km


    <h6> {% trans 'The Driver is' %} </h6>   <a href="{% url 'profile' route.thedriver.id %}" ><strong> {{route.thedriver}} </strong></a>
    <p hidden id="cost_{{route.id}}"><h6>{% trans 'Initial cost per passenger' %} {{route.cost}} {%trans '$' %}</h6>
    <h6> {% trans 'Expected cost per passenger' %}  <strong id="costpp_{{route.id}}">{{route.costpp}}{%trans '$' %}</strong></h6>
         {% if route.d_a %}
          <h6> {% trans 'Disabled access' %} <i class="fa fa-wheelchair" aria-hidden="true"></i>
</h6>
          {% endif %}
          <img  class='img-fluid rounded d-block' style="border:1px solid yellow;" src="{{ route.map_pic }}" alt="map_img">


<!--{% if user.is_authenticated %}
                              {% if route.fin or route.fin_set  %}

                        {% if request.user in route.thepassenger.all %}
                 <p>  {% qr_from_text qr.code size="2" image_format="png" error_correction="L" %}   {{qr.passenger}}</p>


                        {% endif %}
                    {% endif %}

                    NO NEED FOR EVERYONE TO KNOW WHO IS ON THE TRIP
                    -->


        {% if route.passengers.all.count != 0 %}
    <p id="likes" style= "color:grey; font-size:12px;mix-blend-mode: multiply;"><img src="{% static  'Capstone/images/seat.jpg' %}" alt="seat image">
        <span><strong id="thepassengercounter_{{route.id}}">{{ route.thepassenger.all.count }}</strong></span>/<span id = 'max_pass_{{route.id}}'>{{ route.no_pass }}</span>

        {% else %}
    <p id="likes" style= "color:grey; font-size:12px;mix-blend-mode: multiply;"><img src="{% static  'Capstone/images/seat.jpg' %}" alt="seat image">
        <span><strong id="thepassengercounter_{{route.id}}">0</strong></span>

       {% endif %}
              </div>
<form action="{% url 'passenger' %}" method="post">
        {% csrf_token %}

        <div class="form-group">
            <input class="form-control"  style="margin-top:30px" type="text" name="comm_txt" placeholder={% trans "Insert your comment"%}>
            <input type="hidden"  name="route_id" value={{route.id}}>

        </div>
    <input class="btn btn-primary"  id='post_btn' type="submit" name="route_reply" value={% trans "Post"%}>

                  {% ifnotequal request.user route.thedriver %}

                <div class="likes">
                  {% if not route.fin and not route.fin_set  %}
                        {% if request.user in route.thepassenger.all %}

                        <span id="leavebtn" class="joinleave" data-id="{{route.id}}" onclick="return false" title="Leave" >{% trans 'Leave' %}</span>

                    {% else %}
                    

                        <span id="joinbtn" class="joinleave" data-id="{{route.id}}" onclick="return false"  title="Join">{% trans 'Join' %}</span>
            {% endif%}
            
                    {% endif %}
                </div>

</form>



        {% endifnotequal %}
        {% ifequal request.user route.thedriver %}
          <form action="{% url 'edit_route' route.pk %}" method="post">
        {% csrf_token %}
            <input class="btn btn-success" type="button"  name="load_route" value="Edit Trip"  onclick="location.href='{% url 'edit_route' route.pk %}'"  />
            <input type="hidden"  name="route_to_load_id" value={{route.pk}}>
          </form>
        {%endifequal %}



{% endif %}





  </div>
                            {% for rep in route.comments.all %}
 <ul style="Î¹margin-left:130px;">



        <div class="comms "><p style= "color:blue; font-size:10px; "><a href="{% url 'profile' rep.owner_id %}">{{rep.owner}}</a>
            {% trans 'commented on'%}: {{rep.created_date}}</p> <strong>{{rep}} </strong>

</ul>
      {% endfor %}
          {% endfor %}
  </div>



  </div>
</div>




<h2 class="page">{% trans  'Page' %}: {{ page.number }}</h2>
        <div class="page-links">

            {% if page.has_previous %}
            <a href="{% url 'passenger' %}?page={{page.previous_page_number }}">{% trans 'Previous' %}</a>

            {% endif %}
            {% if page.has_next %}
            <a href="{% url 'passenger' %}?page={{page.next_page_number }}">{% trans 'Next' %}</a>
            {% endif %}

        </div>




{% block script %}
    <script src="{% static 'Capstone/join_leave.js' %}"></script>

{% endblock script %}
{% endblock %}